<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>String Art Guide</title>

<style>
html, body { margin: 0; font-family: Arial, sans-serif; background: linear-gradient(to bottom, #f0f4f8, #d9e2ec); height: 100%; overflow-y: auto; }
header { text-align: center; padding: 8px; font-size: 1.3rem; font-weight: bold; color: #fff; background: #4a90e2; }

#speedControlContainer { display: flex; align-items: center; padding: 5px 10px; background: #eef3f7; font-size: 0.9rem; gap: 5px; flex-wrap: wrap; }
#speedLabel { flex: 0 0 auto; }
#speedInput { flex: 1 1 auto; }

#progress { text-align: center; padding: 5px 0; font-size: 2rem; font-weight: bold; background: #dfe7f2; }

#pinDisplay {
  display: flex;
  align-items: center;
  overflow-x: auto;
  padding: 5px;
  gap: 10px;
  height: 35vh;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x mandatory;
}

.pin-number {
  flex: 0 0 15%;
  text-align: center;
  font-weight: bold;
  border-radius: 12px;
  background: #fff;
  padding: 10px 0;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  user-select: none;
  scroll-snap-align: center;
  transition: all 0.3s ease;
  cursor: pointer;
}

.pin-number.current {
  font-size: 3rem;
  background: #4a90e2;
  color: #fff;
  flex: 0 0 25%;
  transform: scale(1.2);
}

.pin-number.previous, .pin-number.next {
  font-size: 1.8rem;
  color: #555;
}

/* BOTTONI PRINCIPALI */
#navButtons {
  display: flex;
  justify-content: space-around;
  padding: 5px 10px;
  gap: 10px;
  margin-bottom: 80px;
  margin-top: 0px;
}

#navButtons button {
  flex: 1 1 auto;
  padding: 12px;
  font-size: 1.2rem;
  border-radius: 12px;
  background: #4a90e2;
  color: #fff;
  border: none;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  transition: transform 0.1s ease, background 0.2s ease;
}

#navButtons button:active { transform: scale(0.95); }
#navButtons button:disabled { background: #aaa; }

/* BOTTONI â€“100 +100 */
#fastNavButtons {
  display: flex;
  justify-content: space-around;
  padding: 5px 10px;
  gap: 10px;
  margin-bottom: 50px;
}

#fastNavButtons button {
  flex: 1 1 auto;
  padding: 10px;
  font-size: 1rem;
  border-radius: 12px;
  background: #6aa4e8;
  color: #fff;
  border: none;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  transition: transform 0.1s ease, background 0.2s ease;
}

#fastNavButtons button:active { transform: scale(0.95); }

#saveButtonContainer { display: none; justify-content: center; padding: 5px 10px;}
#saveButtonContainer button {
  padding: 10px 20px;
  font-size: 1.1rem;
  border-radius: 12px;
  background: #4a90e2;
  color: #fff;
  border: none;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  transition: transform 0.1s ease;
}

#saveButtonContainer button:active { transform: scale(0.95); }

#bottomControls {
  display: flex;
  justify-content: space-around;
  padding: 5px 10px;
  gap: 5px;
}

#bottomControls button,
#bottomControls input[type=file] {
  flex: 1 1 auto;
  padding: 6px;
  font-size: 0.9rem;
  border-radius: 10px;
  border: none;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  background: #4a90e2;
  color: #fff;
}

input[type=file] { background: #fff; color: #333; }

@media(max-width: 480px) {
  .pin-number.current { font-size: 2.5rem; flex: 0 0 30%; }
  .pin-number.previous, .pin-number.next { font-size: 1.5rem; flex: 0 0 15%; }
  #navButtons button { font-size: 1rem; padding: 10px; }
  #fastNavButtons button { font-size: 1rem; padding: 10px; }
}
</style>
</head>
<body>

<div id="speedControlContainer">
  <span id="speedLabel">VelocitÃ : <span id="speedValue">3.0s</span></span>
  <input type="range" id="speedInput" min="0.5" max="10" step="0.1" value="3">
</div>

<div id="progress">0 / 0</div>

<div id="pinDisplay"></div>

<!-- BOTTONI PRINCIPALI -->
<div id="navButtons">
  <button onclick="step(-1)" id="prevBtn" disabled>Â« Prev</button>
  <button onclick="toggleAuto()" id="autoBtn">â–¶ Play</button>
  <button onclick="step(1)" id="nextBtn" disabled>Next Â»</button>
</div>

<!-- BOTTONI VELOCI -->
<div id="fastNavButtons">
  <button onclick="step(-100)" id="back100">Â« -100</button>
  <button onclick="step(100)" id="forward100">+100 Â»</button>
</div>

<div id="saveButtonContainer">
  <button onclick="savePosition()">ðŸ’¾ Save</button>
</div>

<div id="bottomControls">
  <input type="file" id="fileInput" accept=".txt">
  <button onclick="loadFile()">Load</button>
</div>

<script>
let sequence = [];
let currentIndex = 0;
let autoInterval = null;

function initializePins() {
  const container = document.getElementById('pinDisplay');
  container.innerHTML = '';
  for (let i = 0; i < sequence.length; i++) {
    const pinEl = document.createElement('div');
    pinEl.classList.add('pin-number');
    pinEl.textContent = sequence[i];
    pinEl.addEventListener('click', () => {
      currentIndex = i;
      highlightCurrentPin();
    });
    container.appendChild(pinEl);
  }
}

function highlightCurrentPin() {
  const container = document.getElementById('pinDisplay');
  const pins = container.children;

  for (let i = 0; i < pins.length; i++) {
    pins[i].classList.remove('current', 'previous', 'next');
    if (i < currentIndex) pins[i].classList.add('previous');
    else if (i > currentIndex) pins[i].classList.add('next');
  }

  if (pins[currentIndex]) pins[currentIndex].classList.add('current');

  // CENTRATURA PERFETTA
  pins[currentIndex].scrollIntoView({
    behavior: "smooth",
    block: "nearest",
    inline: "center"
  });

  document.getElementById('prevBtn').disabled = currentIndex <= 0;
  document.getElementById('nextBtn').disabled = currentIndex >= sequence.length - 1;

  saveMemory();
  updateProgress();

  speakNumber(sequence[currentIndex]);
}

function step(amount) {
  currentIndex += amount;
  if (currentIndex < 0) currentIndex = 0;
  if (currentIndex > sequence.length - 1) currentIndex = sequence.length - 1;
  highlightCurrentPin();
}

function loadFile() {
  const fileInput = document.getElementById('fileInput');
  const file = fileInput.files[0];
  if (!file) return alert("Select a pin file.");
  const reader = new FileReader();
  reader.onload = function(e) {
    sequence = e.target.result.trim().split(/[\s,]+/).map(Number);
    currentIndex = 0;
    initializePins();
    highlightCurrentPin();
  }
  reader.readAsText(file);
}

function saveMemory() {
  localStorage.setItem('stringart_sequence', JSON.stringify(sequence));
  localStorage.setItem('stringart_index', currentIndex);
}

function loadFromMemory() {
  const savedSequence = localStorage.getItem('stringart_sequence');
  const savedIndex = localStorage.getItem('stringart_index');
  if (savedSequence) {
    sequence = JSON.parse(savedSequence);
    currentIndex = savedIndex ? parseInt(savedIndex, 10) : 0;
    initializePins();
    highlightCurrentPin();
  }
}

function savePosition() {
  let archive = JSON.parse(localStorage.getItem('stringart_archive') || '[]');
  archive.unshift({index: currentIndex, sequence: sequence});
  if (archive.length > 10) archive.pop();
  localStorage.setItem('stringart_archive', JSON.stringify(archive));
  alert('Position saved!');
}

function updateProgress() {
  document.getElementById('progress').textContent = `${currentIndex + 1} / ${sequence.length}`;
}

function toggleAuto() {
  const btn = document.getElementById('autoBtn');
  if (autoInterval) {
    clearInterval(autoInterval);
    autoInterval = null;
    btn.textContent = 'â–¶ Play';
  } else {
    const speed = parseFloat(document.getElementById('speedInput').value) * 1000 || 3000;
    autoInterval = setInterval(() => {
      if (currentIndex >= sequence.length - 1) {
        clearInterval(autoInterval);
        autoInterval = null;
        btn.textContent = 'â–¶ Play';
      } else step(1);
    }, speed);
    btn.textContent = 'â¸ Pause';
  }
}

const speedInput = document.getElementById('speedInput');
const speedValue = document.getElementById('speedValue');
speedInput.addEventListener('input', () => {
  speedValue.textContent = parseFloat(speedInput.value).toFixed(1) + 's';
  if (autoInterval) { toggleAuto(); toggleAuto(); }
});

loadFromMemory();
speedValue.textContent = speedInput.value + 's';

function speakNumber(num) {
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(num.toString());
  utterance.lang = 'it-IT';

  const voices = window.speechSynthesis.getVoices();
  const italianFemale = voices.find(voice =>
    voice.lang.startsWith('it') && /female|feminine|f/i.test(voice.name)
  );

  if (italianFemale) utterance.voice = italianFemale;
  else {
    const italianVoice = voices.find(voice => voice.lang.startsWith('it'));
    if (italianVoice) utterance.voice = italianVoice;
  }

  utterance.rate = 1;
  utterance.pitch = 1.2;
  window.speechSynthesis.speak(utterance);
}

window.speechSynthesis.onvoiceschanged = () => {};

</script>
</body>
</html>
